@model AutoSignals.ViewModels.TestOrderViewModel
@{
    ViewData["Title"] = "Test Exchange Order";
}

<div class="d-flex align-items-center justify-content-between page-header-breadcrumb flex-wrap gap-2 mb-3">
    <div>
        <h1 class="page-title fw-medium fs-18 mb-0">Test Exchange Order</h1>
        <small class="text-muted">Send a single test entry order.</small>
    </div>
</div>

<form asp-action="Index" method="post" class="card p-3 shadow-sm">
    @Html.AntiForgeryToken()
    <div class="row g-3">
        <div class="col-md-2">
            <label asp-for="Exchange" class="form-label">Exchange</label>
            <select asp-for="Exchange" class="form-select">
                <option value="OKX">OKX</option>
                <option value="BITGET">Bitget</option>
                <option value="BYBIT">Bybit</option>
            </select>
        </div>

        <div class="col-md-3">
            <label class="form-label">Symbol</label>
            <input class="form-control" value="BTC/USDT:USDT" disabled />
            <input type="hidden" asp-for="Symbol" value="BTC/USDT:USDT" />
        </div>

        <div class="col-md-2">
            <label class="form-label">Side</label>
            <!-- Bind to existing Direction property to avoid breaking the ViewModel -->
            <select asp-for="Direction" class="form-select">
                <option value="buy">buy</option>
                <option value="sell">sell</option>
            </select>
        </div>

        <div class="col-md-2">
            <label asp-for="Price" class="form-label">Price</label>
            <input asp-for="Price" class="form-control" type="number" step="0.1" />
        </div>

        <div class="col-md-2">
            <label asp-for="Stoploss" class="form-label">Stoploss</label>
            <input asp-for="Stoploss" class="form-control" type="number" step="0.1" />
        </div>

        <div class="col-md-1">
            <label asp-for="Size" class="form-label">Size</label>
            <input asp-for="Size" class="form-control" type="number" step="0.0001" />
        </div>

        <div class="col-md-1">
            <label asp-for="Leverage" class="form-label">Leverage</label>
            <select asp-for="Leverage" class="form-select">
                @for (var x = 1; x <= 20; x++)
                {
                    <option value="@x">@x</option>
                }
            </select>
        </div>

        <div class="col-md-2">
            <label class="form-label">Description</label>
            <select name="Description" class="form-select">
                <option value="Initial Entry Order">Initial Entry Order</option>
                <option value="DCA1 Entry Order">DCA1 Entry Order</option>
                <option value="DCA2 Entry Order">DCA2 Entry Order</option>
                <option value="Take Profit Order 1">Take Profit Order 1</option>
                <option value="Take Profit Order 1 + MSL">Take Profit Order 1 + MSL</option>
                <option value="Moonbag Order">Moonbag Order</option>
            </select>
            <small class="text-muted">Note: Take Profit (TP) orders are a percentage value.</small>
        </div>

        <div class="col-md-1 d-flex align-items-end">
            <div class="form-check mt-2">
                <input asp-for="IsIsolated" class="form-check-input" type="checkbox" />
                <label class="form-check-label">Isolated</label>
            </div>
        </div>
    </div>

    <!-- Ensure Status is always OPEN -->
    <input type="hidden" name="Status" value="OPEN" />

    <fieldset class="mt-4">
        <legend class="fs-6">API Credentials (Not Persisted)</legend>
        <div class="row g-3">
            <div class="col-md-4">
                <label asp-for="ApiKey" class="form-label">API Key</label>
                <input asp-for="ApiKey" class="form-control" autocomplete="off" />
            </div>
            <div class="col-md-4">
                <label asp-for="ApiSecret" class="form-label">API Secret</label>
                <input asp-for="ApiSecret" class="form-control" autocomplete="off" />
            </div>
            <div class="col-md-4">
                <label asp-for="Password" class="form-label">Password / Passphrase</label>
                <input asp-for="Password" class="form-control" autocomplete="off" />
            </div>
        </div>
    </fieldset>

    <div class="mt-4">
        <button type="submit" class="btn btn-primary">Send Test Order</button>
    </div>

    <div class="mt-3 text-danger" asp-validation-summary="ModelOnly"></div>
</form>

@if (!string.IsNullOrWhiteSpace(Model?.ResponseJson))
{
    <div class="card mt-4">
        <div class="card-header">
            <strong>Exchange Response</strong>
        </div>
        <div class="card-body">
            <pre class="mb-0" style="white-space:pre-wrap;font-size:0.85rem;color:#fff;">@Model.ResponseJson</pre>
        </div>
    </div>
}